---
- hosts: localhost
  tasks:
    - name: Remove password file
      raw: rm -rf /src/test/ansible/vault.pass

- hosts: all
  become: no
  gather_facts: no
  vars_files:
    - /src/test/ansible/vars/vault.yml
  tasks:
  - name: Ensure python installed
    raw: apt update && apt -y install python gnupg2 curl wget

- hosts: all
  become: yes
  gather_facts: yes

  vars_files:
    - /src/test/ansible/vars/vault.yml
  tasks:
  - name: Add Repo key
    raw: wget -qO- https://repos.influxdata.com/influxdb.key | apt-key add -

  - name: Add InfluxDB repo
    raw: echo "deb https://repos.influxdata.com/debian buster stable" | tee /etc/apt/sources.list.d/influxdb.list
  
  - name: Telegraf installation
    apt:
      name: telegraf
      update_cache: yes
      state: present
  
  - name: Start Telegraf service
    raw: service telegraf start